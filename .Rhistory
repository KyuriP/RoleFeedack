mutate(diff = highnet_m - lownet_m) |>
pivot_longer(!c(edge, diff), names_to = c("id", ".value"), names_sep = "_") |>
# by 2 (becuz of id) --> if want 7, then 14
mutate(high_diff = diff %in% sort(diff, decreasing = TRUE)[1:14],
low_diff = diff %in% sort(diff)[1:14],
m_min = m - sd,
m_max = m + sd,
# reorder the edge by highest to lowest
edge = factor(edge, levels = edge[order(m[id == "highnet"], decreasing = TRUE)])) |>
group_by(id) |>
# total 32 chocies, half top == 16
mutate(top10_freq = rank(-m) <= 13) |>
ungroup()
rlang::last_trace()
plotdf <- top10_he |> full_join(top10_le, by = join_by(Var1)) |>
set_names(c("edge", "highnet_m","highnet_sd", "highnet_me", "lownet_m", "lownet_sd", "lownet_me")) |>
mutate(diff = highnet_m - lownet_m,
# reorder the edge by highest to lowest
edge = factor(edge, levels = edge[order(highnet_m, decreasing = TRUE)])) |>
pivot_longer(!c(edge, diff), names_to = c("id", ".value"), names_sep = "_") |>
# by 2 (becuz of id) --> if want 7, then 14
mutate(high_diff = diff %in% sort(diff, decreasing = TRUE)[1:14],
low_diff = diff %in% sort(diff)[1:14],
m_min = m - sd,
m_max = m + sd) |>
group_by(id) |>
# total 32 chocies, half top == 16
mutate(top10_freq = rank(-m) <= 13) |>
ungroup()
plotdf
# Reorder the edges based on the "highnet" group frequency
plotdf <- plotdf %>%
mutate(edge = factor(edge, levels = edge[order(m[id == "highnet"], decreasing = TRUE)]))
plotdf$edge |> str()
# Step 1: Calculate the mean frequency for each edge in the "highnet" group
edge_order <- plotdf %>%
filter(id == "highnet") %>%
group_by(edge) %>%
summarize(mean_m = mean(m)) %>%
arrange(desc(mean_m)) %>%
pull(edge)
edge_order
# Step 2: Reorder the `edge` factor based on the calculated means
plotdf <- plotdf %>%
mutate(edge = factor(edge, levels = edge_order))
# Main plot without legend
main_plot <- ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 1) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.5) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "coral", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "darkseagreen", size = 2,  alpha = 0.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen")) +
labs(y = "Proportion of edge frequency", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_text(angle = 90, vjust= 0.45),
axis.title.y = element_text(vjust = +4, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with diff plot
plot.margin = margin(t = 2, r = 2, b = 0, l = 2, "cm"))
main_plot
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
# overlapping edge (mot -> sui)
plotdf$high_diff[c(63,64)] <- TRUE # sui -> motor : not overlapping hence TRUE
plotdf$low_diff[c(33,34,39,40)] <- TRUE # glt -> app, app -> ene: not overlapping
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
# Custom x-axis labels
# Mapping of numbers to characters
number_to_char <- c("1" = "anh", "2" = "sad", "3" = "slp", "4" = "ene", "5" = "app",
"6" = "glt", "7" = "con", "8" = "mot", "9" = "sui")
# Replace numbers with corresponding characters using str_replace_all
plotdf$edge <- str_replace_all(plotdf$edge, number_to_char) |> as.factor()
# Main plot without legend
main_plot <- ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 1) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.5) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "coral", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "darkseagreen", size = 2,  alpha = 0.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen")) +
labs(y = "Proportion of edge frequency", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_text(angle = 90, vjust= 0.45),
axis.title.y = element_text(vjust = +4, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with diff plot
plot.margin = margin(t = 2, r = 2, b = 0, l = 2, "cm"))
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
# Step 1: Calculate the mean frequency for each edge in the "highnet" group
edge_order <- plotdf %>%
filter(id == "highnet") %>%
group_by(edge) %>%
summarize(mean_m = mean(m)) %>%
arrange(desc(mean_m)) %>%
pull(edge)
# Step 2: Reorder the `edge` factor based on the calculated means
plotdf <- plotdf %>%
mutate(edge = factor(edge, levels = edge_order))
# Main plot without legend
main_plot <- ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 1) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.5) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "coral", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "darkseagreen", size = 2,  alpha = 0.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen")) +
labs(y = "Proportion of edge frequency", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_text(angle = 90, vjust= 0.45),
axis.title.y = element_text(vjust = +4, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with diff plot
plot.margin = margin(t = 2, r = 2, b = 0, l = 2, "cm"))
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
View(plotdf)
plotdf$low_diff[18,] <- FALSE
plotdf$low_diff[18] <- FALSE
# Main plot without legend
main_plot <- ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 1) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.5) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "coral", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "darkseagreen", size = 2,  alpha = 0.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen")) +
labs(y = "Proportion of edge frequency", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_text(angle = 90, vjust= 0.45),
axis.title.y = element_text(vjust = +4, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with diff plot
plot.margin = margin(t = 2, r = 2, b = 0, l = 2, "cm"))
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
View(plotdf)
plotdf$low_diff[c(17,18)] <- FALSE # slp -> ene overlapping hence FALSE
plotdf$low_diff[c(1,2, 21, 22, 17,18)] <- FALSE # anh ->sad, ene -> anh : they are not freq poitns. slp -> ene overlapping hence FALSE
# Main plot without legend
main_plot <- ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 1) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.5) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "coral", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "darkseagreen", size = 2,  alpha = 0.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen")) +
labs(y = "Proportion of edge frequency", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_text(angle = 90, vjust= 0.45),
axis.title.y = element_text(vjust = +4, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with diff plot
plot.margin = margin(t = 2, r = 2, b = 0, l = 2, "cm"))
# Diff plot with x-axis on top
diff_plot <-ggplot(data = plotdf) +
geom_line(aes(x = edge, y = diff), group = 1, linetype = "dashed", color = "gray", alpha = 0.7) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, color = "coral4"), size = 3.5, shape = 8, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff), color = "darkseagreen4", size = 3.5, shape = 8, alpha = 0.3) +
#scale_color_manual(values = c("High diff. points" = "coral4")) +
scale_y_reverse(breaks = scales::pretty_breaks(n = 3), limits = c(0.028, -0.028)) +
scale_x_discrete(position = "top", labels = custom_labels) +
labs(y = "Difference", x = "Edges", color = "") +
theme_pubr() +
theme(legend.position = "none",  # Remove legend
text = element_text(size = 23, family = "Palatino"),
axis.text.x = element_blank(),
axis.title.y = element_text(vjust = +1.5, size = 26),
axis.title.x = element_blank(), # Remove x-axis title to share with main plot
plot.margin = margin(t = 0, r = 2, b = 1.5, l = 2, "cm"))
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8)) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
# Extract legend from one of the plots
legend <- cowplot::get_plot_component(
ggplot(data = plotdf) +
geom_point(aes(x = edge, y = m, col = id), alpha = 0.8, shape = 1, size = 3) +
geom_line(aes(x = edge, y = m, col = id, group = id), alpha = 0.6) +
geom_errorbar(aes(x = edge, ymin = m_min, ymax = m_max, color = id), width = 0.3, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "highnet", top10_freq), aes(x = edge, y = m), color = "black", size = 2, alpha = 0.5) +
geom_point(data = plotdf %>% filter(id == "lownet", top10_freq), aes(x = edge, y = m), color = "black", size = 2) +
geom_line(aes(x = edge, y = diff, col = "diff", linetype = "diff"), group = 1,alpha = 0.5) +
geom_point(data = plotdf %>% filter(high_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "coral4", size = 3.5, alpha = 0.3) +
geom_point(data = plotdf %>% filter(low_diff), aes(x = edge, y = diff, shape = "Large diff. points"), color = "black", size = 3.5) +
scale_x_discrete(labels = custom_labels) +
scale_color_manual(values = c("highnet" = "coral", "lownet" = "darkseagreen"),
labels = c("High symptom level network", "Low symptom level network")) +
scale_shape_manual(values = c("Large diff. points" = 8), labels = c("Sig. high-frequency points")) +
scale_linetype_manual(values = c("diff" = 2), labels = c("Difference (high-low)"))+
labs(y = "Proportion of edge frequency", x = "Edges", color = "", linetype = "", shape = "") +
theme_pubr() +
guides(
color = guide_legend(title = "", order = 1),
linetype = guide_legend(title = "", order = 2),
shape = guide_legend(title = "", order = 3, color = "black", byrow = TRUE)
) +
theme(
text = element_text(size = 23, family="Palatino"),
legend.text=element_text(size=20),
legend.key.size = unit(2,"line"),
legend.position = "bottom",
legend.spacing.y = unit(-0.5, "cm"),
legend.spacing.x = unit(-0.25, "cm")
),
'guide-box-bottom', return_all = TRUE)
# Combine plots with shared x-axis
combined_plot <- cowplot::plot_grid(main_plot, diff_plot, ncol = 1, align = "v", axis = "lr", rel_heights = c(3, 1.3))
# Combine the plot and the legend
final_plot <- cowplot::plot_grid(combined_plot, legend, NULL, ncol = 1, rel_heights = c(8, 1, 0.5))
final_plot
ggsave("figure/edge_plot3.pdf", plot = final_plot, width = 40, height = 30, units = "cm", dpi = 300)
